# k8s/kind/manifests/03-secret.yaml
# Donnees sensibles (credentials)
# IMPORTANT : En production, utiliser Sealed Secrets ou External Secrets Operator

apiVersion: v1
kind: Secret
metadata:
  name: quiz-secrets
  namespace: quiz-app
  labels:
    app: quiz-backend
  annotations:
    description: "Credentials sensibles - Ne pas commiter en clair"
    rotation-policy: "90-days"
type: Opaque
stringData:
  # Mot de passe simple pour dev local uniquement
  DATABASE_URL: "postgresql://quiz_user:quiz@postgres:5432/quiz_db"
  JWT_SECRET: "dev-secret-key-change-in-production"

# NOTE : En production, utiliser :
# 1. Sealed Secrets (chiffre avec cle publique)
# 2. External Secrets Operator (synchronise depuis Vault/AWS Secrets Manager)
# 3. encryption-at-rest dans etcd

---
# SECRETS mTLS
# Ces secrets sont générés par les scripts scripts/certs/*.sh
# NE PAS créer manuellement - utiliser ./scripts/certs/03-import-to-k8s.sh
#
# Structure attendue après génération:
#
# apiVersion: v1
# kind: Secret
# metadata:
#   name: mtls-ca
#   namespace: quiz-app
#   labels:
#     app: quiz-backend
#   annotations:
#     description: "CA publique pour mTLS"
# type: Opaque
# data:
#   ca.crt: <base64-encoded>
#
# ---
# apiVersion: v1
# kind: Secret
# metadata:
#   name: gateway-tls
#   namespace: quiz-app
#   labels:
#     app: quiz-backend
#     service: gateway
# type: kubernetes.io/tls
# data:
#   tls.crt: <base64-encoded>
#   tls.key: <base64-encoded>
#   ca.crt: <base64-encoded>
#
# ---
# apiVersion: v1
# kind: Secret
# metadata:
#   name: quiz-service-tls
#   namespace: quiz-app
#   labels:
#     app: quiz-backend
#     service: quiz-service
# type: kubernetes.io/tls
# data:
#   tls.crt: <base64-encoded>
#   tls.key: <base64-encoded>
#   ca.crt: <base64-encoded>
#
# ---
# apiVersion: v1
# kind: Secret
# metadata:
#   name: auth-service-tls
#   namespace: quiz-app
#   labels:
#     app: quiz-backend
#     service: auth-service
# type: kubernetes.io/tls
# data:
#   tls.crt: <base64-encoded>
#   tls.key: <base64-encoded>
#   ca.crt: <base64-encoded>
#
# COMMANDES:
# cd scripts/certs
# ./01-generate-ca.sh
# ./02-generate-service-certs.sh
# ./03-import-to-k8s.sh
